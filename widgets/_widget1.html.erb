
<script src="/js/jQuery/jquery-ui-1.8.5.custom.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/js/jquery.colorbox.js" type="text/javascript" charset="utf-8"></script>
<script src="/js/jQuery/ui/jquery.ui.draggable.js" type="text/javascript" charset="utf-8"></script>
<script src="/js/jQuery/ui/jquery.ui.droppable.js" type="text/javascript" charset="utf-8"></script>
<script src="/js/sm2/soundmanager2.js" type="text/javascript"></script>


<style type="text/css">
  .widget { width: 450px; height: 300px; border: 1px solid #222222; background-color: #aadddd;}
	.shopping-card { font-size: 20px; float: right; background-color: gray; margin: 10px; width: 110px; height: 80px; }
	.header { font-size: 24px; margin: 10px;}
	.shiny { background-color: #00f; }
	.buy-button { float: right; width: inherit; height: 30px; margin: 10px; font-size: 20px;}
	.title-list { float: left; margin: 10px; font-size: 16px; height: 200px; width: 150px; border: 2px solid gray;}
</style>
<link rel="stylesheet" href="/css/jQuery/theme/jquery.ui.all.css" type="text/css" title="no title" charset="utf-8">
<link rel="stylesheet" href="/css/jQuery/theme/jquery-ui-1.8.5.custom.css" type="text/css" title="no title" charset="utf-8">

<div class="widget">
	<div class="content">
		<div class="header" style="float: left;"><%= @account.name + "´s musicstore" %></div>
		<div class="clearer">&nbsp;</div>
		<div class="title-list">
		<div class="draggable" id="dummy">
			<%= link_to "dummy", '#', :onclick => "preview('dummy.mp3'); return false;" %>
		</div>
		<% for sound in @music_titles do %>
			<p>
				<div id="shouldbethetitlefixit" class="draggable">
					<%= link_to "#{sound.titel}", '#', :onclick => "preview('#{sound.titel}'); return false;" %>
				</div>
			</p>
		<% end %>
		</div>
		<div class="shopping-card" id="droppable"> Warenkorb </div>
		<div class="clearer">&nbsp;</div>
		<div class="buy-button">
			<div style="margin-top: 5px;"><%= link_to "Kaufen", widgets_path(:order_hash => "new Hammer", :account => "mkuntze"), :method => :post %></div>
		</div>
	</div>
</div>
<script type="text/javascript">
var orderHash = "";
// --- function for drag&drop functionality for the listed items
$(function() {
	$(".draggable").children().draggable({
		revert: true,
		revertDuration: 400,
		scope: 'bamWidget8499372901ßßß20_398'
	});
	$("#droppable").droppable({
		drop: function( event, ui ) {
			$( this ).addClass( "ui-state-highlight" );
			if (orderHash == ""){
				orderHash += ui.draggable.html();
			} else {
				orderHash += "|" + ui.draggable.html();
			};
			ui.draggable.parent().hide();
		},
		scope: 'bamWidget8499372901ßßß20_398',
		activate: function(){ $(this).html('Her damit!'); },
		deactivate: function(){ $(this).html('Warenkorb'); }
	});
});

// --- function for prelistening to the listed tracks in the widget
soundManager.url = '/swf'; // directory where SM2 .SWFs live
// Note that SoundManager will determine and append the appropriate .SWF file to the URL,
// eg. /path/to/sm2-flash-movies/soundmanager2.swf automatically.
// Beta-ish HTML5 audio support (force-enabled for iPad), flash-free sound for Safari + Chrome. Enable if you want to try it!
soundManager.useHTML5Audio = true;
soundManager.debugMode = false;
// do this to skip flash block handling for now. See the flashblock demo when you want to start getting fancy.
soundManager.useFlashBlock = false;
	function preview(title){
	  if (soundManager.supported()) {
			if (mySound == null){
		    var mySound = soundManager.createSound({
		      id: title,
		      url: ('/audios/' + title)
		  	});
			};
			if (mySound.paused){
				mySound.resume();
				$("#dummy").children().removeClass("shiny");
			} else {
				if (mySound.playState == 0){
					mySound.play();	
				} else {
					mySound.pause();
					$("#dummy").children().addClass("shiny");
				};
			};
	  } else {
	    // (Optional) Hrmm, SM2 could not start. Show an error, etc.?
	  };
	};
</script>